<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠØ© Ø§Ù„Ø´Ø±Ù‚ÙŠØ© | Ù…Ø­Ù…Ø¯ Ø¹Ø¯ÙŠ Ù…Ø¤ÙŠØ¯</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;900&display=swap');
        :root { --main-blue: #1e3a8a; --gold: #b45309; }
        body { font-family: 'Tajawal', sans-serif; background: #f8fafc; }
        .hidden { display: none !important; }
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        .tab-btn.active { border-bottom: 3px solid var(--main-blue); color: var(--main-blue); font-weight: 900; }
        .telegram-shadow { box-shadow: 0 2px 15px rgba(0,0,0,0.05); border-right: 4px solid var(--main-blue); }
        .chat-img { max-width: 200px; border-radius: 10px; margin-top: 5px; cursor: pointer; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <div id="login-screen" class="flex-grow flex items-center justify-center p-4">
        <div class="max-w-md w-full glass p-8 rounded-[2.5rem] shadow-2xl border-t-[10px] border-blue-900">
            <div class="text-center mb-6">
                <h1 class="text-3xl font-black text-blue-900">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠØ© Ø§Ù„Ø´Ø±Ù‚ÙŠØ©</h1>
                <p class="text-[10px] font-bold text-amber-700 tracking-widest mt-1">Ø§Ù„Ù…Ø·ÙˆØ±: Ù…Ø­Ù…Ø¯ Ø¹Ø¯ÙŠ Ù…Ø¤ÙŠØ¯ Ø­Ù…Ø§Ø¯ÙŠ</p>
            </div>

            <div class="space-y-4">
                <div class="relative w-24 h-24 mx-auto">
                    <img id="p-img" src="https://via.placeholder.com/150" class="w-full h-full rounded-full border-4 border-blue-50 object-cover shadow-lg">
                    <label class="absolute bottom-0 right-0 bg-blue-900 text-white p-2 rounded-full cursor-pointer shadow-lg">
                        ğŸ“¸ <input type="file" id="u-file" class="hidden" onchange="uploadImg(event)">
                    </label>
                </div>

                <input type="text" id="u-name" class="w-full p-4 bg-gray-50 border-none rounded-2xl text-sm focus:ring-2 focus:ring-blue-900" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„ÙƒØ§Ù…Ù„">
                
                <select id="u-role" class="w-full p-4 bg-gray-50 border-none rounded-2xl text-sm font-bold" onchange="checkRole()">
                    <option value="Ø·Ø§Ù„Ø¨">ğŸ“ Ø·Ø§Ù„Ø¨</option>
                    <option value="Ù…Ø¯Ø±Ø³">ğŸ‘¨â€ğŸ« Ù…Ø¯Ø±Ø³ Ù…Ø§Ø¯Ø©</option>
                    <option value="Ù…Ø¯ÙŠØ±">ğŸ›ï¸ Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</option>
                    <option value="Ù…Ø¹Ø§ÙˆÙ†">ğŸ“‹ Ø§Ù„Ù…Ø¹Ø§ÙˆÙ† Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ</option>
                    <option value="ÙˆÙ„ÙŠ Ø§Ù…Ø±">ğŸ‘ª ÙˆÙ„ÙŠ Ø£Ù…Ø± Ø·Ø§Ù„Ø¨</option>
                </select>

                <input type="password" id="u-code" class="hidden w-full p-4 bg-red-50 border border-red-100 rounded-2xl text-sm" placeholder="Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø®Ø§Øµ">

                <div id="student-box" class="grid grid-cols-2 gap-2">
                    <select id="u-grade" class="p-4 bg-blue-50 border-none rounded-2xl text-sm font-bold">
                        <option>Ø§Ù„Ø±Ø§Ø¨Ø¹</option><option>Ø§Ù„Ø®Ø§Ù…Ø³</option><option>Ø§Ù„Ø³Ø§Ø¯Ø³</option>
                    </select>
                    <select id="u-section" class="p-4 bg-blue-50 border-none rounded-2xl text-sm font-bold">
                        <option>Ø£</option><option>Ø¨</option><option>Ø¬</option><option>Ø¯</option><option>Ù‡Ù€</option>
                        <option>Ùˆ</option><option>Ø²</option><option>Ø­</option><option>Ø·</option><option>ÙŠ</option>
                    </select>
                </div>

                <div id="teacher-box" class="hidden space-y-3">
                    <input type="text" id="u-sub" class="w-full p-4 bg-green-50 rounded-2xl text-sm" placeholder="Ø§Ù„Ù…Ø§Ø¯Ø© (Ù…Ø«Ø§Ù„: Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡)">
                    <p class="text-[10px] font-bold text-gray-500 mr-2">Ø­Ø¯Ø¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø¹Ø¨ Ø§Ù„ØªÙŠ ØªØ¯Ø±Ø³Ù‡Ø§:</p>
                    <div class="grid grid-cols-5 gap-2 p-2 bg-gray-100 rounded-2xl" id="sec-checks"></div>
                </div>

                <button onclick="saveAndEnter()" class="w-full bg-blue-900 text-white py-5 rounded-[2rem] font-black text-lg shadow-xl hover:scale-95 transition-all">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ù†ØµØ©</button>
            </div>
        </div>
    </div>

    <div id="app" class="hidden flex flex-col h-screen overflow-hidden">
        <header class="bg-blue-900 text-white p-5 flex justify-between items-center shadow-xl">
            <div class="flex items-center gap-3">
                <img id="h-img" class="w-12 h-12 rounded-full border-2 border-amber-400 object-cover">
                <div>
                    <h2 id="h-name" class="text-sm font-black"></h2>
                    <p id="h-meta" class="text-[9px] text-blue-200 font-bold uppercase"></p>
                </div>
            </div>
            <button onclick="exit()" class="bg-white/10 hover:bg-red-600 p-2 px-4 rounded-full text-[10px] font-bold transition-all">Ø®Ø±ÙˆØ¬</button>
        </header>

        <main class="flex-grow overflow-y-auto p-4 pb-28">
            <div id="pub-box" class="hidden mb-6 bg-white p-4 rounded-3xl shadow-lg border-2 border-blue-100">
                <textarea id="p-text" class="w-full p-3 bg-gray-50 border-none rounded-2xl text-sm outline-none" rows="3" placeholder="Ù…Ø§Ø°Ø§ ØªØ±ÙŠØ¯ Ø£Ù† ØªÙ†Ø´Ø± Ø§Ù„ÙŠÙˆÙ…ØŸ"></textarea>
                <div class="flex gap-2 mt-3">
                    <label class="bg-gray-100 p-3 rounded-2xl cursor-pointer">ğŸ–¼ï¸ <input type="file" class="hidden" id="p-file" accept="image/*"></label>
                    <button onclick="postNow()" class="flex-grow bg-blue-900 text-white font-bold rounded-2xl text-xs">Ù†Ø´Ø± ÙÙŠ Ø§Ù„Ù‚Ù†Ø§Ø© Ø§Ù„Ø±Ø³Ù…ÙŠØ©</button>
                </div>
            </div>

            <div id="view-home" class="space-y-4"></div>
            <div id="view-chat" class="hidden flex flex-col h-full">
                <div id="chat-msgs" class="flex-grow overflow-y-auto space-y-3 p-2"></div>
                <div class="p-3 bg-white rounded-3xl shadow-xl flex gap-2">
                    <label class="p-3 bg-gray-100 rounded-full cursor-pointer">ğŸ“·<input type="file" class="hidden" id="c-file" onchange="sendImg(event)"></label>
                    <input type="text" id="c-inp" class="flex-grow text-sm outline-none" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø´Ø¹Ø¨Ø©...">
                    <button onclick="sendTxt()" class="bg-blue-900 text-white p-3 px-6 rounded-full">ğŸš€</button>
                </div>
            </div>
            <div id="view-admin" class="hidden space-y-3"></div>
        </main>

        <nav class="fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur-md border-t flex justify-around p-4 shadow-2xl">
            <button onclick="tab('home')" class="tab-btn active text-xs flex flex-col items-center">ğŸ“¢<span>Ø§Ù„Ù‚Ù†ÙˆØ§Øª</span></button>
            <button onclick="tab('chat')" id="n-chat" class="tab-btn text-xs flex flex-col items-center">ğŸ’¬<span>Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©</span></button>
            <button onclick="tab('admin')" id="n-admin" class="hidden tab-btn text-xs flex flex-col items-center">ğŸ“Š<span>Ø§Ù„Ø·Ù„Ø§Ø¨</span></button>
        </nav>
    </div>

    <script>
        let u = null;
        const S = ["Ø£", "Ø¨", "Ø¬", "Ø¯", "Ù‡Ù€", "Ùˆ", "Ø²", "Ø­", "Ø·", "ÙŠ"];
        const CODES = {"Ù…Ø¯ÙŠØ±":"1010", "Ù…Ø¹Ø§ÙˆÙ†":"2020", "Ù…Ø¯Ø±Ø³":"3030"};

        // ØªÙˆÙ„ÙŠØ¯ Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„Ù…Ø¯Ø±Ø³
        S.forEach(s => document.getElementById('sec-checks').innerHTML += `<label class="text-[10px] flex items-center gap-1"><input type="checkbox" value="${s}"> ${s}</label>`);

        window.onload = () => {
            const data = localStorage.getItem('school_db');
            if(data) { u = JSON.parse(data); enterApp(); }
        }

        function uploadImg(e) {
            const r = new FileReader();
            r.onload = () => { document.getElementById('p-img').src = r.result; u = u || {}; u.img = r.result; };
            r.readAsDataURL(e.target.files[0]);
        }

        function checkRole() {
            const r = document.getElementById('u-role').value;
            document.getElementById('u-code').classList.toggle('hidden', r === 'Ø·Ø§Ù„Ø¨' || r === 'ÙˆÙ„ÙŠ Ø§Ù…Ø±');
            document.getElementById('teacher-box').classList.toggle('hidden', r !== 'Ù…Ø¯Ø±Ø³');
        }

        function saveAndEnter() {
            const name = document.getElementById('u-name').value;
            const role = document.getElementById('u-role').value;
            const code = document.getElementById('u-code').value;
            if(!name || !document.getElementById('p-img').src.includes('data')) return alert("Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„ØµÙˆØ±Ø© Ù…Ø·Ù„ÙˆØ¨Ø§Ù†");
            if(CODES[role] && code !== CODES[role]) return alert("Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ Ø®Ø·Ø£");

            let tSecs = [];
            document.querySelectorAll('#sec-checks input:checked').forEach(c => tSecs.push(c.value));

            u = {
                name, role, img: document.getElementById('p-img').src,
                grade: document.getElementById('u-grade').value,
                sec: document.getElementById('u-section').value,
                sub: document.getElementById('u-sub').value,
                tSecs: tSecs
            };
            localStorage.setItem('school_db', JSON.stringify(u));
            enterApp();
        }

        function enterApp() {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            document.getElementById('h-img').src = u.img;
            document.getElementById('h-name').innerText = u.name;
            document.getElementById('h-meta').innerText = `${u.role} | ${u.grade} - ${u.sec}`;

            if(u.role !== 'Ø·Ø§Ù„Ø¨' && u.role !== 'ÙˆÙ„ÙŠ Ø§Ù…Ø±') document.getElementById('pub-box').classList.remove('hidden');
            if(u.role === 'Ù…Ø¯ÙŠØ±' || u.role === 'Ù…Ø¹Ø§ÙˆÙ†') document.getElementById('n-admin').classList.remove('hidden');
            if(u.role === 'ÙˆÙ„ÙŠ Ø§Ù…Ø±') document.getElementById('n-chat').classList.add('hidden');
        }

        function tab(t) {
            ['home', 'chat', 'admin'].forEach(v => document.getElementById('view-'+v).classList.add('hidden'));
            document.getElementById('view-'+t).classList.remove('hidden');
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            event.currentTarget.classList.add('active');
            if(t === 'admin') renderStudents();
        }

        function postNow() {
            const txt = document.getElementById('p-text').value;
            if(!txt) return;
            const post = `<div class="bg-white p-5 rounded-3xl telegram-shadow mb-4">
                <div class="flex items-center gap-2 mb-2">
                    <img src="${u.img}" class="w-6 h-6 rounded-full">
                    <b class="text-xs text-blue-900">${u.role === 'Ù…Ø¯Ø±Ø³' ? 'Ù‚Ù†Ø§Ø© Ù…Ø§Ø¯Ø© ' + u.sub : 'ØªØ¨Ù„ÙŠØº Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©'}</b>
                </div>
                <p class="text-sm text-gray-700">${txt}</p>
                <p class="text-[8px] text-gray-400 mt-2">Ø¨ÙˆØ§Ø³Ø·Ø©: ${u.name} â€¢ Ø§Ù„Ø¢Ù†</p>
            </div>`;
            document.getElementById('view-home').insertAdjacentHTML('afterbegin', post);
            document.getElementById('p-text').value = "";
        }

        function sendTxt() {
            const t = document.getElementById('c-inp').value; if(!t) return;
            appendChat(`<b>Ø£Ù†Øª:</b><br>${t}`);
            document.getElementById('c-inp').value = "";
        }

        function sendImg(e) {
            const r = new FileReader();
            r.onload = () => appendChat(`<img src="${r.result}" class="chat-img">`);
            r.readAsDataURL(e.target.files[0]);
        }

        function appendChat(html) {
            const box = document.getElementById('chat-msgs');
            box.innerHTML += `<div class="bg-blue-100 p-3 rounded-2xl rounded-tr-none ml-auto w-fit text-sm shadow-sm">${html}</div>`;
            box.scrollTop = box.scrollHeight;
        }

        function renderStudents() {
            document.getElementById('view-admin').innerHTML = `<h2 class="font-black text-blue-900">Ø³Ø¬Ù„ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</h2>
            <div class="bg-white p-4 rounded-3xl flex items-center gap-4">
                <img src="${u.img}" class="w-12 h-12 rounded-full border-2 border-blue-900">
                <div><p class="font-bold text-sm">${u.name}</p><p class="text-[10px] text-gray-400">Ø¢Ø®Ø± Ø¸Ù‡ÙˆØ±: Ø§Ù„Ø¢Ù†</p></div>
            </div>`;
        }

        function exit() { localStorage.removeItem('school_db'); location.reload(); }
    </script>
</body>
</html>
