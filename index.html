<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠØ© Ø§Ù„Ø´Ø±Ù‚ÙŠØ© - Ù…Ø­Ù…Ø¯ Ø¹Ø¯ÙŠ Ù…Ø¤ÙŠØ¯</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap');
        body { font-family: 'Tajawal', sans-serif; background: #f0f4f8; color: #1a202c; }
        .hidden { display: none !important; }
        .app-card { background: white; border-radius: 20px; padding: 15px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); margin-bottom: 15px; }
        .telegram-post { background: #ffffff; border-radius: 12px; padding: 12px; border-right: 4px solid #0088cc; box-shadow: 0 2px 4px rgba(0,0,0,0.05); position: relative; }
        .chat-bubble { max-width: 85%; padding: 10px; border-radius: 15px; font-size: 13px; margin-bottom: 8px; }
        .btn-primary { background: #1e3a8a; color: white; transition: 0.3s; }
        .btn-primary:hover { background: #172554; }
    </style>
</head>
<body class="min-h-screen">

    <div id="login-screen" class="max-w-lg mx-auto my-10 p-8 bg-white rounded-[2.5rem] shadow-2xl border-t-8 border-blue-900">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-blue-900">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠØ© Ø§Ù„Ø´Ø±Ù‚ÙŠØ©</h1>
            <p class="text-sm text-gray-500 font-bold mt-2">ØªØµÙ…ÙŠÙ… Ø§Ù„Ø·Ø§Ù„Ø¨: Ù…Ø­Ù…Ø¯ Ø¹Ø¯ÙŠ Ù…Ø¤ÙŠØ¯</p>
        </div>

        <div class="space-y-4">
            <div class="flex flex-col items-center">
                <img id="previewImg" src="https://via.placeholder.com/100" class="w-24 h-24 rounded-full border-4 border-blue-100 object-cover shadow-md">
                <input type="file" id="userPhoto" class="hidden" onchange="previewFile(event)">
                <button onclick="document.getElementById('userPhoto').click()" class="mt-2 text-xs text-blue-700 font-bold underline">Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ©</button>
            </div>

            <input type="text" id="regName" class="w-full p-4 border rounded-2xl text-sm" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„ÙƒØ§Ù…Ù„">
            <input type="tel" id="regPhone" class="w-full p-4 border rounded-2xl text-sm" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
            
            <select id="regRole" class="w-full p-4 border rounded-2xl font-bold text-sm bg-gray-50" onchange="toggleRoleFields()">
                <option value="Ø·Ø§Ù„Ø¨">Ø·Ø§Ù„Ø¨</option>
                <option value="Ù…Ø¯Ø±Ø³">Ù…Ø¯Ø±Ø³ Ù…Ø§Ø¯Ø©</option>
                <option value="Ù…Ø¯ÙŠØ±">Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</option>
                <option value="Ù…Ø¹Ø§ÙˆÙ†">Ø§Ù„Ù…Ø¹Ø§ÙˆÙ† Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ</option>
                <option value="ÙˆÙ„ÙŠ Ø§Ù…Ø±">ÙˆÙ„ÙŠ Ø£Ù…Ø± Ø·Ø§Ù„Ø¨</option>
            </select>

            <input type="password" id="regCode" class="hidden w-full p-4 border border-red-200 rounded-2xl text-sm" placeholder="Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø®Ø§Øµ">

            <div id="student-group" class="grid grid-cols-2 gap-3">
                <select id="regGrade" class="p-4 border rounded-2xl text-sm font-bold bg-blue-50">
                    <option value="Ø§Ù„Ø±Ø§Ø¨Ø¹">Ø§Ù„Ø±Ø§Ø¨Ø¹</option><option value="Ø§Ù„Ø®Ø§Ù…Ø³">Ø§Ù„Ø®Ø§Ù…Ø³</option><option value="Ø§Ù„Ø³Ø§Ø¯Ø³">Ø§Ù„Ø³Ø§Ø¯Ø³</option>
                </select>
                <select id="regSection" class="p-4 border rounded-2xl text-sm font-bold bg-blue-50">
                    <option value="Ø£">Ø´Ø¹Ø¨Ø© Ø£</option><option value="Ø¨">Ø´Ø¹Ø¨Ø© Ø¨</option><option value="Ø¬">Ø´Ø¹Ø¨Ø© Ø¬</option><option value="Ø¯">Ø´Ø¹Ø¨Ø© Ø¯</option><option value="Ù‡Ù€">Ø´Ø¹Ø¨Ø© Ù‡Ù€</option><option value="Ùˆ">Ø´Ø¹Ø¨Ø© Ùˆ</option><option value="Ø²">Ø´Ø¹Ø¨Ø© Ø²</option><option value="Ø­">Ø´Ø¹Ø¨Ø© Ø­</option><option value="Ø·">Ø´Ø¹Ø¨Ø© Ø·</option><option value="ÙŠ">Ø´Ø¹Ø¨Ø© ÙŠ</option>
                </select>
            </div>

            <div id="teacher-group" class="hidden space-y-4 border-t pt-4">
                <input type="text" id="regSubject" class="w-full p-4 border rounded-2xl text-sm" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„ØªÙŠ ØªØ¯Ø±Ø³Ù‡Ø§">
                <p class="text-[10px] font-bold text-blue-900">Ø§Ø®ØªØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø¹Ø¨ Ø§Ù„ØªÙŠ ØªØ¯Ø±Ø³Ù‡Ø§:</p>
                <div class="grid grid-cols-5 gap-2" id="sections-checkboxes">
                    </div>
            </div>

            <button onclick="login()" class="w-full btn-primary py-5 rounded-2xl font-bold shadow-xl text-lg mt-6">Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…Ù†ØµØ©</button>
        </div>
    </div>

    <div id="app" class="hidden flex flex-col h-screen">
        <header class="bg-blue-900 text-white p-4 flex justify-between items-center shadow-lg">
            <div class="flex items-center gap-3">
                <img id="navPhoto" class="w-12 h-12 rounded-full border-2 border-white object-cover">
                <div>
                    <h2 id="navName" class="text-sm font-bold leading-tight"></h2>
                    <p id="navMeta" class="text-[10px] text-blue-200 font-bold"></p>
                </div>
            </div>
            <button onclick="logout()" class="bg-red-500 text-white px-4 py-2 rounded-xl text-[10px] font-bold">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
        </header>

        <main class="flex-grow overflow-y-auto p-4 pb-32">
            <div id="teacher-panel" class="hidden app-card border-2 border-blue-400">
                <h3 class="text-xs font-bold mb-3">Ø§Ù„Ù‚Ù†Ø§Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù„Ù„Ø£Ø³ØªØ§Ø°: <span id="teacherSub"></span></h3>
                <textarea id="teacherMsg" class="w-full p-3 border rounded-xl text-sm" placeholder="Ø§Ù†Ø´Ø± Ø¯Ø±Ø³Ø§Ù‹ØŒ ØµÙˆØ±Ø©ØŒ Ø£Ùˆ Ù…Ù„Ù..."></textarea>
                <div class="flex gap-2 mt-2">
                    <button class="bg-gray-100 p-2 rounded-xl text-xs flex-1">ğŸ“· ØµÙˆØ±Ø©</button>
                    <button class="bg-gray-100 p-2 rounded-xl text-xs flex-1">ğŸ“ Ù…Ù„Ù</button>
                    <button onclick="teacherPost()" class="bg-blue-600 text-white p-2 rounded-xl text-xs font-bold flex-[2]">Ù†Ø´Ø± ÙÙŠ Ø§Ù„Ù‚Ù†Ø§Ø©</button>
                </div>
            </div>

            <div id="admin-panel" class="hidden app-card border-2 border-red-500">
                <h3 class="text-xs font-bold mb-2">ØªÙˆØµÙŠØ§Øª ÙˆØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h3>
                <textarea id="adminMsg" class="w-full p-3 border rounded-xl text-sm" placeholder="Ø±Ø³Ø§Ù„Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ§Ù„Ù…Ø¯Ø±Ø³ÙŠÙ†..."></textarea>
                <button onclick="adminPost()" class="w-full bg-red-600 text-white py-2 rounded-xl mt-2 text-xs font-bold">Ù†Ø´Ø± Ø§Ù„Ø¢Ù†</button>
            </div>

            <div id="main-feed" class="space-y-4">
                <h2 class="text-xs font-bold text-gray-500 mb-2">Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª ÙˆØ§Ù„Ù‚Ù†ÙˆØ§Øª:</h2>
                <div id="feed-container" class="space-y-4"></div>
            </div>

            <div id="stats-panel" class="hidden space-y-4">
                <h2 class="text-sm font-bold text-blue-900 border-b pb-2">Ø³Ø¬Ù„ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø­Ø³Ø¨ Ø§Ù„Ø´Ø¹Ø¨:</h2>
                <div id="students-list" class="space-y-2"></div>
            </div>
        </main>

        <nav class="fixed bottom-0 left-0 right-0 bg-white border-t flex justify-around p-3 shadow-2xl z-50">
            <button onclick="showTab('home')" class="flex flex-col items-center"><span class="text-2xl">ğŸ“¢</span><span class="text-[9px] font-bold">Ø§Ù„Ù‚Ù†ÙˆØ§Øª</span></button>
            <button id="nav-chat" onclick="showTab('chat')" class="flex flex-col items-center"><span class="text-2xl">ğŸ’¬</span><span class="text-[9px] font-bold">Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©</span></button>
            <button id="nav-admin-only" onclick="showTab('stats')" class="hidden flex flex-col items-center"><span class="text-2xl">ğŸ“Š</span><span class="text-[9px] font-bold">Ø§Ù„Ø·Ù„Ø§Ø¨</span></button>
        </nav>
    </div>

    <script>
        let me = null;
        const CODES = { "Ù…Ø¯ÙŠØ±": "9900", "Ù…Ø¹Ø§ÙˆÙ†": "8800", "Ù…Ø¯Ø±Ø³": "7700" };
        const sections = ["Ø£", "Ø¨", "Ø¬", "Ø¯", "Ù‡Ù€", "Ùˆ", "Ø²", "Ø­", "Ø·", "ÙŠ"];

        // Ù…Ù„Ø¡ Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø´Ø¹Ø¨ Ù„Ù„Ù…Ø¯Ø±Ø³
        const sectionContainer = document.getElementById('sections-checkboxes');
        sections.forEach(s => {
            sectionContainer.innerHTML += `<label class="text-[10px] font-bold flex items-center gap-1"><input type="checkbox" name="teachSec" value="${s}"> ${s}</label>`;
        });

        window.onload = () => {
            const saved = localStorage.getItem('shrqia_user');
            if (saved) { me = JSON.parse(saved); renderApp(); }
        };

        function previewFile(e) {
            const reader = new FileReader();
            reader.onload = () => document.getElementById('previewImg').src = reader.result;
            reader.readAsDataURL(e.target.files[0]);
        }

        function toggleRoleFields() {
            const r = document.getElementById('regRole').value;
            document.getElementById('regCode').classList.toggle('hidden', r === 'Ø·Ø§Ù„Ø¨' || r === 'ÙˆÙ„ÙŠ Ø§Ù…Ø±');
            document.getElementById('teacher-group').classList.toggle('hidden', r !== 'Ù…Ø¯Ø±Ø³');
        }

        function login() {
            const name = document.getElementById('regName').value;
            const role = document.getElementById('regRole').value;
            const code = document.getElementById('regCode').value;
            const photo = document.getElementById('previewImg').src;

            if (!name || photo.includes('placeholder')) return alert("ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„ØµÙˆØ±Ø©");
            if (CODES[role] && code !== CODES[role]) return alert("Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ Ø®Ø§Ø·Ø¦");

            let teacherSections = [];
            if(role === 'Ù…Ø¯Ø±Ø³') {
                document.querySelectorAll('input[name="teachSec"]:checked').forEach(el => teacherSections.push(el.value));
            }

            me = {
                name, role, photo,
                grade: document.getElementById('regGrade').value,
                section: document.getElementById('regSection').value,
                subject: document.getElementById('regSubject').value,
                tSections: teacherSections
            };

            localStorage.setItem('shrqia_user', JSON.stringify(me));
            renderApp();
        }

        function logout() { localStorage.removeItem('shrqia_user'); location.reload(); }

        function renderApp() {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            document.getElementById('navPhoto').src = me.photo;
            document.getElementById('navName').innerText = me.name;
            document.getElementById('navMeta').innerText = `${me.role} | ${me.grade} - ${me.section}`;

            if (me.role === 'Ù…Ø¯Ø±Ø³') {
                document.getElementById('teacher-panel').classList.remove('hidden');
                document.getElementById('teacherSub').innerText = me.subject;
            } else if (me.role === 'Ù…Ø¯ÙŠØ±' || me.role === 'Ù…Ø¹Ø§ÙˆÙ†') {
                document.getElementById('admin-panel').classList.remove('hidden');
                document.getElementById('nav-admin-only').classList.remove('hidden');
            }
        }

        function showTab(tab) {
            const feed = document.getElementById('main-feed');
            const stats = document.getElementById('stats-panel');
            if (tab === 'home') { feed.classList.remove('hidden'); stats.classList.add('hidden'); }
            else if (tab === 'stats') { feed.classList.add('hidden'); stats.classList.remove('hidden'); loadStudents(); }
        }

        function adminPost() {
            const txt = document.getElementById('adminMsg').value;
            if(!txt) return;
            const post = `<div class="telegram-post border-red-500"><b class="text-red-600 text-[11px]">ğŸ”´ ØªÙˆØµÙŠØ© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© (${me.role})</b><p class="text-sm mt-1">${txt}</p><span class="text-[8px] text-gray-400 block text-left">Ø§Ù„Ø¢Ù†</span></div>`;
            document.getElementById('feed-container').insertAdjacentHTML('afterbegin', post);
            document.getElementById('adminMsg').value = "";
        }

        function teacherPost() {
            const txt = document.getElementById('teacherMsg').value;
            if(!txt) return;
            const post = `<div class="telegram-post"><b class="text-blue-600 text-[11px]">ğŸ“š Ù‚Ù†Ø§Ø© ${me.subject} | Ø§Ù„Ø£Ø³ØªØ§Ø° ${me.name}</b><p class="text-sm mt-1">${txt}</p><span class="text-[8px] text-gray-400 block text-left">Ù…ÙˆØ¬Ù‡ Ù„Ø´Ø¹Ø¨: ${me.tSections.join(', ')}</span></div>`;
            document.getElementById('feed-container').insertAdjacentHTML('afterbegin', post);
            document.getElementById('teacherMsg').value = "";
        }

        function loadStudents() {
            const list = document.getElementById('students-list');
            list.innerHTML = `<div class="flex items-center gap-3 bg-white p-3 rounded-xl shadow-sm">
                <img src="${me.photo}" class="w-10 h-10 rounded-full border">
                <div><p class="text-xs font-bold">${me.name}</p><p class="text-[9px] text-gray-500">${me.role} - Ø´Ø¹Ø¨Ø© ${me.section}</p></div>
            </div>`;
        }
    </script>
</body>
</html>
